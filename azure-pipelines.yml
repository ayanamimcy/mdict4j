trigger:
  branches:
    include:
      - main
      - releases/*
  tags:
    include:
      - v*

jobs:
- job: check
  pool:
    image: ubuntu-latest
  steps:
  - task: Gradle@2
    displayName: run gradle check
    inputs:
      javaHomeOption: 'JDKVersion'
      jdkVersionOption: '1.8'
      tasks: 'check'
  - task: Gradle@2
    displayName: Publish package to OSSRH
    inputs:
      options: '-PsigningPassword=$(GPG_SIGNING_PASSPHRASE) -PsonatypeUsername=$(SONATYPE_USER) -PsonatypePassword=$(SONATYPE_PASSWORD)'
      javaHomeOption: 'JDKVersion'
      jdkVersionOption: '1.8'
      tasks: 'publishToSonatype'
    condition: and(succeeded(), startsWith(variables['build.sourceBranch'], 'refs/tags/v'))
